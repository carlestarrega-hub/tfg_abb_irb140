<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Control ABB IRB140</title>
<script src="https://cdn.jsdelivr.net/npm/roslib@1/build/roslib.min.js"></script>

<style>
  body { font-family: 'Segoe UI', sans-serif; background-color: #eef2f5; text-align: center; padding: 20px; }
  
  .panel { 
    background: white; 
    padding: 30px; 
    border-radius: 15px; 
    box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
    max-width: 500px; 
    margin: auto; 
    position: relative;
  }

  h1 { margin-top: 0; color: #333; font-size: 24px; text-transform: uppercase; letter-spacing: 1px;}
  h3 { margin-bottom: 10px; color: #555; border-bottom: 2px solid #eee; padding-bottom: 5px; font-size: 18px;}
  
  /* Inputs de Posici√≥n */
  label { font-weight: bold; color: #666; margin-right: 5px; }
  input[type=number] { 
    width: 70px; padding: 8px; font-size: 16px; 
    text-align: center; border: 1px solid #ddd; border-radius: 5px; margin-right: 10px;
  }

  /* Sliders */
  input[type=range] { width: 100%; margin: 10px 0; accent-color: #007bff; cursor: pointer; }
  .val-display { font-weight:bold; color:#007bff; font-size: 14px; float: right; }
  .slider-group { text-align: left; margin-bottom: 20px; }
  .slider-label { font-size: 14px; color: #444; font-weight: 600; }

  /* BOTONES EST√ÅNDAR */
  .btn {
    background-color: #007bff; color: white; border: none;
    padding: 15px; font-size: 18px; cursor: pointer;
    border-radius: 8px; width: 100%; transition: 0.2s; font-weight: bold;
    margin-top: 10px;
    box-shadow: 0 4px 0 #0056b3; /* Efecto 3D */
  }
  .btn:hover { background-color: #0056b3; transform: translateY(2px); box-shadow: 0 2px 0 #0056b3; }
  .btn:active { transform: translateY(4px); box-shadow: none; }

  /* BOT√ìN POSICI√ìN INICIAL (Gris/Azulado) */
  .btn-home {
    background-color: #6c757d; 
    box-shadow: 0 4px 0 #545b62;
    margin-bottom: 20px;
  }
  .btn-home:hover { background-color: #5a6268; }

  /* BOT√ìN STOP (SETA DE EMERGENCIA) */
  .btn-stop {
    background-color: #dc3545; color: white; border: none;
    width: 80px; height: 80px; font-size: 20px; font-weight: bold;
    border-radius: 50%; /* Redondo */
    cursor: pointer;
    box-shadow: 0 6px 0 #a71d2a, 0 10px 20px rgba(0,0,0,0.3);
    position: absolute; /* Lo colocamos en la esquina */
    top: -20px; right: -20px;
    border: 4px solid white;
    z-index: 100;
  }
  .btn-stop:active { 
    transform: translateY(6px); 
    box-shadow: 0 0 0 #a71d2a; 
  }

  /* Estado */
  #statusIndicator { display:inline-block; width:15px; height:15px; border-radius:50%; background-color:red; margin-right:5px; vertical-align: middle; }
  #statusText { font-weight: bold; vertical-align: middle; }
  .status-bar { background: #f8f9fa; padding: 10px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #eee;}

</style>

<script type="text/javascript">
  var ros;
  var ordenTopic;

  function init() {
    // 1. Conectar con ROS
    ros = new ROSLIB.Ros({ url : 'ws://localhost:9090' });

    ros.on('connection', function() {
        document.getElementById("statusIndicator").style.backgroundColor = "#28a745"; // Verde
        document.getElementById("statusText").innerHTML = "CONECTADO";
        document.getElementById("statusText").style.color = "#28a745";
    });

    ros.on('error', function(error) {
        document.getElementById("statusIndicator").style.backgroundColor = "orange";
        document.getElementById("statusText").innerHTML = "ERROR DE CONEXI√ìN";
    });

    ros.on('close', function() {
        document.getElementById("statusIndicator").style.backgroundColor = "red";
        document.getElementById("statusText").innerHTML = "DESCONECTADO";
        document.getElementById("statusText").style.color = "red";
    });

    // 2. Definir el T√≥pico
    ordenTopic = new ROSLIB.Topic({
      ros : ros,
      name : '/orden_web',
      messageType : 'std_msgs/String'
    });
  }

  function updateDisplay(id, val) {
    document.getElementById(id).innerText = val + "¬∞";
  }

  // FUNCI√ìN PARA ENVIAR MOVIMIENTO NORMAL
  function enviarCoordenadas() {
    var x = document.getElementById("posX").value;
    var y = document.getElementById("posY").value;
    var z = document.getElementById("posZ").value;

    var r = document.getElementById("sl_roll").value;
    var p = document.getElementById("sl_pitch").value;
    var w = document.getElementById("sl_yaw").value;

    // Formato: "MOVE:X,Y,Z,ROLL,PITCH,YAW"
    var comando = "MOVE:" + x + "," + y + "," + z + "," + r + "," + p + "," + w;

    ordenTopic.publish(new ROSLIB.Message({ data : comando }));
    console.log("Enviado: " + comando);
  }

  // üè† FUNCI√ìN POSICI√ìN INICIAL
  function irAHome() {
    // 1. Poner los valores en los inputs visualmente
    document.getElementById("posX").value = 0.4;
    document.getElementById("posY").value = 0.0;
    document.getElementById("posZ").value = 0.5;
    
    document.getElementById("sl_roll").value = 0;
    document.getElementById("sl_pitch").value = 0;
    document.getElementById("sl_yaw").value = 0;

    // Actualizar los numeritos de los sliders
    updateDisplay('disp_roll', 0);
    updateDisplay('disp_pitch', 0);
    updateDisplay('disp_yaw', 0);

    // 2. Enviar la orden al robot
    enviarCoordenadas();
  }

  // ‚ö†Ô∏è FUNCI√ìN PARADA DE EMERGENCIA
  function paradaEmergencia() {
    var comando = "STOP";
    ordenTopic.publish(new ROSLIB.Message({ data : comando }));
    alert("‚õî ¬°PARADA DE EMERGENCIA ENVIADA!"); 
    console.log("PARADA DE EMERGENCIA ACTIVADA");
  }

</script>
</head>

<body onload="init()">

  <div class="panel">
    <button class="btn-stop" onclick="paradaEmergencia()">STOP</button>

    <h1>ü§ñ Control de ABB IRB140</h1>
    
    <div class="status-bar">
        <span id="statusIndicator"></span>
        <span id="statusText">Esperando...</span>
    </div>

    <h3>üìç Coordenadas</h3>
    <div style="margin-bottom: 20px;">
      <label>X</label> <input type="number" id="posX" value="0.5" step="0.1">
      <label>Y</label> <input type="number" id="posY" value="0.0" step="0.1">
      <label>Z</label> <input type="number" id="posZ" value="0.5" step="0.1">
    </div>

    <h3>üîÑ Orientaci√≥n</h3>

    <div class="slider-group">
      <div class="slider-label">Giro de Mu√±eca</div>
      <span id="disp_roll" class="val-display">0¬∞</span>
      <input type="range" id="sl_roll" min="-180" max="180" value="0" oninput="updateDisplay('disp_roll', this.value)">
    </div>

    <div class="slider-group">
      <div class="slider-label">Inclinaci√≥n</div>
      <span id="disp_pitch" class="val-display">0¬∞</span>
      <input type="range" id="sl_pitch" min="-90" max="90" value="0" oninput="updateDisplay('disp_pitch', this.value)">
    </div>

    <div class="slider-group">
      <div class="slider-label">Orientaci√≥n Lateral</div>
      <span id="disp_yaw" class="val-display">0¬∞</span>
      <input type="range" id="sl_yaw" min="-180" max="180" value="0" oninput="updateDisplay('disp_yaw', this.value)">
    </div>

    <hr>

    <button class="btn btn-home" onclick="irAHome()">‚åÇ POSICI√ìN INICIAL</button>
    <button class="btn" onclick="enviarCoordenadas()">üöÄ EJECUTAR MOVIMIENTO</button>

  </div>

</body>
</html>
